{% extends 'manage/manage_base.html' %}
{% set page='events' -%}

{% block manage_title %}
  Event Survey for "{{ event.title }}"
{% endblock %}

{% block site_css %}
  {{ super() }}
  <style type="text/css">
  td.ordering {
    vertical-align: middle;
  }
  td.question {
    width: 80%;
  }
  textarea {
    width: 100%;
    height: 140px;
  }
  p.is-active {
    color: green;
  }
  p.not-active {
    color: red;
  }
  </style>
{% endblock %}

{% block site_js %}
  {{ super() }}
  {% compress js %}
  <script src="{{ static('manage/js/survey-edit.js') }}"></script>
  {% endcompress %}
{% endblock %}

{% block manage_content %}

<form action="" method="post">
  {{ csrf() }}
  {% if survey.active %}
    <p class="is-active">Survey is currently <b>active</b>.
  {% else %}
    <p class="not-active">Survey is currently <b>not</b> active.
  {% endif %}
    <button type="submit" name="toggle" class="btn btn-primary">Toggle</button>
  </p>
</form>

<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>JSON</th>
      <th>Order</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  {% for question in questions %}
  <tr>
      <td class="question">
        <textarea name="question">{{ json_print(question.question, indent=2) }}</textarea>
      </td>
      <td class="ordering">
        <form method="post" action="{{ url('manage:event_survey_question_edit', event.id, question.id) }}">
          {{ csrf() }}
          <button class="btn btn-sm ordering-up" name="ordering" value="up"><i class="glyphicon glyphicon-arrow-up"></i></button><br>
          <button class="btn btn-sm ordering-down" name="ordering" value="down"><i class="glyphicon glyphicon-arrow-down"></i></button>
        </form>
      </td>
      <td>
        <form method="post" style="display:inline" class="edit"
              action="{{ url('manage:event_survey_question_edit', event.id, question.id) }}">
          {{ csrf() }}
          <button class="btn btn-primary btn-sm">
            <i class="glyphicon glyphicon-floppy-disk"></i>
            Save
          </button>
        </form>
        <form method="post" class="confirm"
              action="{{ url('manage:event_survey_question_delete', event.id, question.id) }}">
          {{ csrf() }}
          <button class="btn btn-danger btn-sm" type="submit">
            <i class="glyphicon glyphicon-trash"></i>
            Delete
          </button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<form method="post" action="{{ url('manage:event_survey_question_new', event.id) }}">
  {{ csrf() }}
  <button class="btn btn-primary">
    <i class="glyphicon glyphicon-plus-sign"></i>
    New question
  </button>
</form>

<p style="margin-top:25px">
  <a href="{{ url('manage:event_edit', event.pk) }}">&larr; Return to event</a>
</p>

{% endblock %}
